# How clients use this API

### ‚ö†Ô∏è &nbsp; Requirements

Clients must meet two requirements to use the API:

1. <b>All requests must contain a body with two required `k:v` pairs:</b> <code><span style="color:#FF6D60">client_uuid</span>: str</code> and <code><span style="color:#FF6D60">access_code</span>: str</code>
   - Both `client_uuid` and `access_code` must evalute to a valid `UUID()`.
     - I.e., `client_uuid` and `access_code` should both be generated by using `UUID.uuid4().hex`
   - The <b style="color:#98D8AA">client</b> is responsible for generating these values on client creation, and for storing and reusing them in future requests for authentication.
2. <b>New clients must <span style="color:#FF6D60">POST</span> their <code>client_uuid</code> and <code>access_code</code> to <code>/api/v1/new/client</code> and receive a <code>client_id</code> before they can use any other endpoints (see below).</b>

### Reddit account security

Serveddit assigns Reddit accounts to a generic `access_id` integer that is managed by a unique `client_id`. Only the user's client knows which `access_id` goes with which Reddit account, so unauthorized access to an account impossible.

## There are <span style="color:#F3E99F">four endpoints</span> exposed to clients (the other endpoints are landing zones for Reddit redirects).

Each endpoint corresponds to a CRUD method:

1. <code><span style="color:#FF6D60">POST</span> /api/v1/new/{<span style="color:#F7D060">object</span>: str}</code>
   - Create a new object in the database.
   - <span style="color:#F7D060">Params:</span>
     - `object` the string `"client"` or `"access"`
   - <span style="color:#88D8AA">Returns:<span> (depending on the object specified).
     - `client_id: int` used to identify a user's client in the database.
     - `access_id: int` used to identify a user's Reddit account.
2. üåü <code><span style="color:#FF6D60">GET</span> /api/v1/client/</code>
   - This is the main endpoint for clients. If an `access_id` parameter is provided (and the other necessary requirements have been met), this endpoint authenticates access to a client's Reddit account.
   - <span style="color:#F7D060">Params:</span>
     - `client_id: int` The client's id in the database. <u>Required</u>.
     - `access_id: Optional[int]` if specified, this is a request for an `access_token` for a Reddit account.
   - <span style="color:#88D8AA">Returns:<span> (depending on the object specified)
     - `client: Client` your `Client` object in the database, including its `account_id`s.
     - `access_token: str` if an `access_id` was provided, Servedd will request an `access_token` from Reddit and return it to the client. An `access_token` expires after one hour.
3. <code><span style="color:#FF6D60">PUT</span> /api/v1/client/</code>
   - This is used if a client needs to replace its authentication details in the database.
   - The <span style="color:##FF6D60">body</span> (NOT as a <span style="color:#F7D060">parameter</span>) of the request should use the old info to authenticate as usual, plus the following `k:v` pairs:
     - `new_client_uuid: Optional[str]` if specified, replaces `client_uuid`
     - `new_access_code: Optional[str]` if specified, replaces `access_code`
   - <span style="color:#F7D060">Params:</span>
     - `client_id: int`
4. <code><span style="color:#FF6D60">DELETE</span></code>
   - Used to delete Reddit account access and clients from the database.
   - <span style="color:#F7D060">Params:</span>
     - `client_id: int` the client's id in the database.
     - `account_id: Optional[int]` the account's id in the database. If this is not set, this endpoint will delete the client specified by `client_id` from the database instead.
